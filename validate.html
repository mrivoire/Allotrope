<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Validation du gain</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body {
    font-family: system-ui, sans-serif;
    background: #111;
    color: #fff;
    padding: 20px;
    text-align: center;
  }
  .box {
    background: #181818;
    padding: 25px;
    border-radius: 16px;
    max-width: 420px;
    margin: auto;
  }
  button {
    margin-top: 20px;
    background: #f5c242;
    color: #111;
    padding: 12px 22px;
    border: none;
    border-radius: 999px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
  }
</style>
</head>

<body>
<div class="box">

  <h1>Validation du gain</h1>

  <div id="info"></div>

  <button id="useBtn">Marquer comme utilisé</button>

</div>

<script>
document.addEventListener("DOMContentLoaded", function () {

  const params = new URLSearchParams(window.location.search);
  const gain = params.get("gain");
  const uid  = params.get("uid");

  const key = "allotrope_used_" + uid;
  const alreadyUsed = localStorage.getItem(key);

  const info = document.getElementById("info");

  if (!gain || !uid) {
    info.innerHTML = "<p>❌ Paramètres invalides</p>";
    document.getElementById("useBtn").style.display = "none";
    return;
  }

  if (alreadyUsed) {
    info.innerHTML =
      "<p>Gain : <strong>" + gain + "</strong></p>" +
      "<p>ID : " + uid + "</p>" +
      "<p style='color:#f54242'>⚠️ Déjà marqué comme utilisé</p>";
    return;
  }

  info.innerHTML =
    "<p>Gain : <strong>" + gain + "</strong></p>" +
    "<p>ID : " + uid + "</p>";

  document.getElementById("useBtn").onclick = function () {
    localStorage.setItem(key, "1");
    alert("Gain marqué comme utilisé ✔");
    location.reload();
  };

});
</script>

</body>
</html>
